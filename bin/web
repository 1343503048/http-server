#!/usr/bin/env node

var sys = require('sys'),
    path = require('path'),
    eyes = require('eyes'),
    colors = require('colors'),
    static = require('../vendor/node-static/lib/node-static'),
    http = require('http'),
    argv = require('optimist').argv;

var help = [
    "usage: home [options]",
    "",
    "options:",
    " -p Port to run the home on [8080]",
    " -s --silent Suppress the log messages from the output",
    " -h, --help You're staring at it",
].join('\n');


function log (message) {
  if (!argv.s && !argv.silent) {
    sys.puts(message);
  }
}

function inspect (obj) {
  if (!argv.s || !argv.silent) {
    eyes.inspect(obj);
  }
}

if (argv.h) {
  return sys.puts(help);
}

try {
    var port = argv.p || 8080;
    var file = new(static.Server)(root, { AutoIndex: true, cache: 3600 }); 
    var root = argv.root || "."
   //createServer(argv.p || 8080, options);
    log('Starting up static web server for: '.yellow + root.cyan + ' on port: '.yellow + port.toString().cyan);
    try {
        http.createServer(function(request, response) {
          return request.addListener('end', function() {
            return file.serve(request, response);
          });
        }).listen(port);
    } catch (err) {
        return callback({
            message: err.message
        });
    }
    log('Static web server successfully started at '.green + port.toString().cyan);
    log('Hit CTRL-C to stop the server')
    process.on('SIGINT', function() {
        log('Static web server stopped.'.red);
        return process.exit();
    });
    
}
catch (err) {
  log(err, sys.inspect(options));
}